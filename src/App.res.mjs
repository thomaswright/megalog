// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Days from "./Days.res.mjs";
import * as Entry from "./Entry.res.mjs";
import * as Theme from "./Theme.res.mjs";
import * as React from "react";
import * as Common from "./Common.res.mjs";
import * as Global from "./Global.res.mjs";
import * as Months from "./Months.res.mjs";
import * as MenuBar from "./MenuBar.res.mjs";
import * as Caml_obj from "rescript/lib/es6/caml_obj.js";
import * as Core__Int from "@rescript/core/src/Core__Int.res.mjs";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as Core__Array from "@rescript/core/src/Core__Array.res.mjs";
import * as Core__Option from "@rescript/core/src/Core__Option.res.mjs";
import * as JsxRuntime from "react/jsx-runtime";
import * as ExportFunctionsJs from "./exportFunctions.js";

function App(props) {
  var match = Common.useLocalStorage("data", undefined);
  var setEntries = match[1];
  var entries = match[0];
  var match$1 = Common.useStateWithGetter(function () {
        
      });
  var getEntryToSet = match$1[2];
  var setEntryToSet = match$1[1];
  var match$2 = Theme.useTheme();
  var scrollToRef = React.useRef(undefined);
  React.useEffect(function () {
        Core__Option.mapOr(Core__Option.flatMap(scrollToRef.current, (function (x) {
                    return Global.Derived.getElementByClassOp(x);
                  })), undefined, (function (element) {
                element.scrollIntoView({
                      behavior: "smooth",
                      block: "center"
                    });
                scrollToRef.current = undefined;
              }));
      });
  var startOfCal = new Date(2010, 0, 1);
  var endOfCal = new Date(2030, 0, 1);
  var updateEntry = React.useCallback((function (id, f) {
          setEntries(function (v) {
                return Core__Option.map(v, (function (v_) {
                              return v_.map(function (entry) {
                                          if (entry.id === id) {
                                            return f(entry);
                                          } else {
                                            return entry;
                                          }
                                        });
                            }));
              });
        }), []);
  var sortEntries = function (data) {
    return Core__Option.map(data, (function (v) {
                  return v.toSorted(function (a, b) {
                              return (Core__Option.mapOr(a.date, "", (function (x) {
                                                return Entry.entryDateString(x);
                                              })) + a.id).localeCompare(Core__Option.mapOr(b.date, "", (function (x) {
                                                return Entry.entryDateString(x);
                                              })) + b.id);
                            });
                }));
  };
  var dateSet = new Set(Core__Array.keepSome(Core__Option.getOr(entries, []).map(function (entry) {
                  return entry.date;
                })).map(function (date) {
            return Entry.entryDateString(date);
          }));
  var dateEntries = new Map(Core__Array.keepSome(Core__Option.getOr(entries, []).map(function (entry) {
                  return Core__Option.map(entry.date, (function (v) {
                                return [
                                        v,
                                        entry
                                      ];
                              }));
                })).map(function (param) {
            return [
                    Entry.entryDateString(param[0]),
                    param[1]
                  ];
          }));
  var makeNewEntry = function (entryDate) {
    setEntries(function (v) {
          return sortEntries(Core__Option.map(v, (function (entries) {
                            return entries.concat([{
                                          id: (Core__Array.reduce(entries, 0, (function (a, c) {
                                                      var b = Core__Option.getOr(Core__Int.fromString(c.id, undefined), 0);
                                                      if (Caml_obj.greaterthan(a, b)) {
                                                        return a;
                                                      } else {
                                                        return b;
                                                      }
                                                    })) + 1 | 0).toString(),
                                          date: entryDate,
                                          title: "",
                                          content: "",
                                          lock: false,
                                          hide: false
                                        }]);
                          })));
        });
  };
  var onClickDate = function (entryDate) {
    ((function (x) {
            if (x !== undefined) {
              Caml_option.valFromOption(x).scrollIntoView({
                    behavior: "smooth",
                    block: "center"
                  });
            } else {
              makeNewEntry(entryDate);
              scrollToRef.current = Entry.entryClassNameId(entryDate);
            }
          })(Global.Derived.getElementByClassOp(Entry.entryClassNameId(entryDate))));
    var tmp;
    switch (entryDate.TAG) {
      case "Year" :
          tmp = Global.Derived.getElementByIdOp("dayview-" + Entry.entryDateString({
                    TAG: "Date",
                    _0: entryDate._0,
                    _1: 1,
                    _2: 1
                  }));
          break;
      case "Quarter" :
          tmp = Global.Derived.getElementByIdOp("dayview-" + Entry.entryDateString({
                    TAG: "Date",
                    _0: entryDate._0,
                    _1: Math.imul(entryDate._1 - 1 | 0, 3),
                    _2: 1
                  }));
          break;
      case "Month" :
          tmp = Global.Derived.getElementByIdOp("dayview-" + Entry.entryDateString({
                    TAG: "Date",
                    _0: entryDate._0,
                    _1: entryDate._1,
                    _2: 1
                  }));
          break;
      case "Week" :
      case "Date" :
          tmp = Global.Derived.getElementByClassOp("monthview-" + Entry.entryDateString({
                    TAG: "Year",
                    _0: entryDate._0
                  }));
          break;
      
    }
    Core__Option.mapOr(getEntryToSet(), Core__Option.mapOr(tmp, undefined, (function (element) {
                element.scrollIntoView({
                      behavior: "smooth",
                      block: "center"
                    });
              })), (function (entryId) {
            updateEntry(entryId, (function (e) {
                    return {
                            id: e.id,
                            date: entryDate,
                            title: e.title,
                            content: e.content,
                            lock: e.lock,
                            hide: e.hide
                          };
                  }));
            setEntryToSet(function (param) {
                  
                });
          }));
  };
  var formatContentForFile = function (entry) {
    return "Date: " + Core__Option.mapOr(entry.date, "", (function (x) {
                  return Entry.entryDateString(x);
                })) + "\nTitle: " + entry.title + "\n\n" + entry.content;
  };
  var onSort = function () {
    setEntries(function (v) {
          return sortEntries(v);
        });
  };
  var onExportFile = function () {
    Core__Option.mapOr(entries, undefined, (function (entries) {
            var prim = entries.map(function (v) {
                    return formatContentForFile(v);
                  }).join("\n\n");
            ExportFunctionsJs.exportToFile(prim);
          }));
  };
  var onExportFolder = function () {
    Core__Option.mapOr(entries, undefined, (function (entries) {
            var prim = entries.map(function (v) {
                  return [
                          Core__Option.mapOr(v.date, "", (function (x) {
                                  return Entry.entryDateString(x);
                                })) + (
                            Core__Option.isSome(v.date) && v.title !== "" ? "_" : ""
                          ) + v.title + ".txt",
                          formatContentForFile(v)
                        ];
                });
            ExportFunctionsJs.exportToFolder(prim);
          }));
  };
  var onShow = function () {
    setEntries(function (v) {
          return Core__Option.map(v, (function (entries) {
                        return entries.map(function (entry) {
                                    return {
                                            id: entry.id,
                                            date: entry.date,
                                            title: entry.title,
                                            content: entry.content,
                                            lock: entry.lock,
                                            hide: false
                                          };
                                  });
                      }));
        });
  };
  var onHide = function () {
    setEntries(function (v) {
          return Core__Option.map(v, (function (entries) {
                        return entries.map(function (entry) {
                                    return {
                                            id: entry.id,
                                            date: entry.date,
                                            title: entry.title,
                                            content: entry.content,
                                            lock: entry.lock,
                                            hide: true
                                          };
                                  });
                      }));
        });
  };
  var onLock = function () {
    setEntries(function (v) {
          return Core__Option.map(v, (function (entries) {
                        return entries.map(function (entry) {
                                    return {
                                            id: entry.id,
                                            date: entry.date,
                                            title: entry.title,
                                            content: entry.content,
                                            lock: true,
                                            hide: entry.hide
                                          };
                                  });
                      }));
        });
  };
  var onUnlock = function () {
    setEntries(function (v) {
          return Core__Option.map(v, (function (entries) {
                        return entries.map(function (entry) {
                                    return {
                                            id: entry.id,
                                            date: entry.date,
                                            title: entry.title,
                                            content: entry.content,
                                            lock: false,
                                            hide: entry.hide
                                          };
                                  });
                      }));
        });
  };
  return JsxRuntime.jsx("div", {
              children: JsxRuntime.jsxs("div", {
                    children: [
                      JsxRuntime.jsxs("div", {
                            children: [
                              JsxRuntime.jsx(MenuBar.SmallBar.make, {
                                    onSort: onSort,
                                    onExportFile: onExportFile,
                                    onExportFolder: onExportFolder,
                                    onShow: onShow,
                                    onHide: onHide,
                                    onLock: onLock,
                                    onUnlock: onUnlock,
                                    theme: match$2[0],
                                    setTheme: match$2[1]
                                  }),
                              JsxRuntime.jsx(Days.make, {
                                    start: startOfCal,
                                    end: endOfCal,
                                    dateSet: dateSet,
                                    onClick: onClickDate,
                                    dateEntries: dateEntries
                                  }),
                              JsxRuntime.jsx(Months.make, {
                                    start: startOfCal,
                                    end: endOfCal,
                                    dateSet: dateSet,
                                    onClick: onClickDate
                                  })
                            ],
                            className: "flex flex-col h-full flex-none w-64 border-r-transparent"
                          }),
                      JsxRuntime.jsx(Entry.Entries.make, {
                            entries: entries,
                            updateEntry: updateEntry,
                            setEntryToSet: setEntryToSet,
                            entryToSet: match$1[0],
                            deleteEntry: (function (id) {
                                setEntries(function (v) {
                                      return Core__Option.map(v, (function (entries) {
                                                    return entries.filter(function (entry) {
                                                                return entry.id !== id;
                                                              });
                                                  }));
                                    });
                              })
                          })
                    ],
                    className: "flex flex-row flex-1 overflow-hidden"
                  }),
              className: "relative font-mono h-dvh flex flex-col bg-[--background] text-[--foreground]"
            });
}

var make = App;

export {
  make ,
}
/* Days Not a pure module */
